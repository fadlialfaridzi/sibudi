<%# =========================================================
  Navbar Outside (Member/Peminjam) - SiBuDi
  Tema: Hijau Unand (#2F7A33), Kuning (#FFD700)
  Responsif: Desktop & Sidebar Mobile
  Gunakan res.locals.user dari session middleware
========================================================= %>

<nav class="fixed top-0 left-0 w-full bg-[#F8FFF8] shadow-sm z-50 transition-all duration-300">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Brand -->
      <div class="flex items-center">
        <a href="/" class="flex items-center gap-3">
          <img
            src="/images/Perpustakaan Unand.jpg"
            alt="SiBuDi Logo"
            class="w-10 h-10 rounded"
          />
          <span class="text-2xl font-bold text-[#2F7A33] tracking-tight">
            SIBUDI
          </span>
        </a>
      </div>

      <!-- Desktop Menu -->
      <div class="hidden md:flex items-center space-x-8">
        <a
          href="/outside/perpanjangan"
          class="nav-link text-gray-700 hover:text-[#2F7A33] font-medium transition"
          data-name="Perpanjangan"
        >
          Detail Peminjaman
        </a>
        <a
          href="/outside/denda"
          class="nav-link text-gray-700 hover:text-[#2F7A33] font-medium transition"
          data-name="Denda"
        >
          Detail Denda
        </a>
        <a
          href="/outside/about"
          class="nav-link text-gray-700 hover:text-[#2F7A33] font-medium transition"
          data-name="About"
        >
          Tentang
        </a>
      </div>

      <!-- Profile / Logout -->
      <div class="hidden md:flex items-center space-x-4">
        <% if (user) { %>
          <span class="text-gray-700">
            Hai, <strong><%= user.member_name || user.id %></strong>
          </span>
          <a
            href="/logout"
            class="px-4 py-1 bg-[#2F7A33] text-white rounded-lg text-sm font-medium hover:bg-[#256328] transition"
          >
            Logout
          </a>
        <% } else { %>
          <a
            href="/login"
            class="px-4 py-1 bg-[#FFD700] text-[#2F7A33] rounded-lg text-sm font-medium hover:bg-yellow-400 transition"
          >
            Login
          </a>
        <% } %>
      </div>

      <!-- Mobile Menu Toggle -->
      <div class="md:hidden flex items-center">
        <button
          id="nav-outside-toggle"
          aria-label="Toggle menu"
          class="p-2 rounded-md text-[#2F7A33] focus:outline-none focus:ring-2 focus:ring-[#FFD700]"
        >
          <svg
            class="w-7 h-7"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Sidebar Menu -->
  <div
    id="nav-outside-menu"
    class="fixed top-0 right-0 h-full w-3/4 bg-[#F8FFF8] shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out md:hidden"
  >
    <div class="flex flex-col h-full justify-between">
      <div class="p-6 space-y-6">
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-bold text-[#2F7A33]">SIBUDI</h2>
          <button id="nav-outside-close" class="text-[#2F7A33] focus:outline-none">
            <svg
              class="w-7 h-7"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <div class="flex flex-col space-y-4 mt-8">
          <a href="/outside/perpanjangan" class="nav-link-mobile text-gray-800 text-lg font-medium hover:text-[#2F7A33] transition" data-name="Perpanjangan">Detail Peminjaman</a>
          <a href="/outside/denda" class="nav-link-mobile text-gray-800 text-lg font-medium hover:text-[#2F7A33] transition" data-name="Denda">Detail Denda</a>
          <a href="/outside/about" class="nav-link-mobile text-gray-800 text-lg font-medium hover:text-[#2F7A33] transition" data-name="About">Tentang</a>
        </div>
      </div>

      <div class="p-6 border-t">
        <% if (user) { %>
          <div class="mb-3 text-gray-700">
            Hai, <strong><%= user.member_name || user.id %></strong>
          </div>
          <a
            href="/logout"
            class="block w-full text-center py-2 bg-[#2F7A33] text-white font-bold rounded-lg hover:bg-[#256328] transition"
          >
            Logout
          </a>
        <% } else { %>
          <a
            href="/login"
            class="block w-full text-center py-2 bg-[#FFD700] text-[#2F7A33] font-bold rounded-lg hover:bg-yellow-400 transition"
          >
            Login
          </a>
        <% } %>
      </div>
    </div>
  </div>

  <style>
    .nav-active {
      color: #2f7a33 !important;
      font-weight: 600;
      position: relative;
    }
    .nav-active::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: #ffd700;
      border-radius: 2px;
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggleBtn = document.getElementById("nav-outside-toggle");
      const closeBtn = document.getElementById("nav-outside-close");
      const menu = document.getElementById("nav-outside-menu");

      toggleBtn?.addEventListener("click", () => menu.classList.remove("translate-x-full"));
      closeBtn?.addEventListener("click", () => menu.classList.add("translate-x-full"));

      const activeName = "<%= typeof activeNav !== 'undefined' ? activeNav : '' %>";
      document.querySelectorAll(".nav-link, .nav-link-mobile").forEach((link) => {
        const name = link.dataset.name;
        if (name.toLowerCase() === activeName.toLowerCase()) {
          link.classList.add("nav-active");
        }
      });
    });
  </script>
</nav>
